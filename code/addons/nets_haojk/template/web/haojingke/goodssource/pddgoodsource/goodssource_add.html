<!DOCTYPE html>
<html>
<link href="./resource/css/bootstrap.min.css?v=20180110" rel="stylesheet">
<link href="./resource/css/common.css?v=20170719" rel="stylesheet">
{template 'haojingke/common/header'}
<script>var require = { urlArgs: 'v=201180110' };</script>
<script type="text/javascript" src="./resource/js/lib/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="./resource/js/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="./resource/js/app/util.js?v=20180110"></script>
<script type="text/javascript" src="./resource/js/app/common.min.js?v=20170719"></script>
<script type="text/javascript" src="./resource/js/require.js?v=20180110"></script>
<script type="text/javascript" src="{NETS_HAOJIK_WEB_STYLE}js/jquery.nestable.js"></script>
<body>
<div class="x-body">
    <form action="" method="post"  enctype="multipart/form-data" class="layui-form">
        <input type="hidden" name="id" value="{$_GPC['id']}">
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>商品源类型
            </label>
            <div class="layui-input-block">
                <label ><input title="条件筛选商品" name="type" type="radio" id="status-1" {if $edit_data['type']!=3} checked="checked" {/if} value="1" onclick="$('#filterpanel').show();$('#icon').hide();"> </label>
                <label style="display: none;"><input title="自选商品" name="type" type="radio"  {if $edit_data['type']==3} checked="checked" {/if} value="3" onclick="$('#filterpanel').hide();$('#icon').show();"</label>
                <span class="x-red"></span>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>商品源名称
            </label>
            <div class="layui-input-inline">
                <input type="text" name="name" lay-verify="name"
                       autocomplete="off" class="layui-input" value="{$edit_data['name']}">
            </div>
            <!--<label class="layui-form-label">-->
            <!--</label>-->
            <div class="layui-form-mid layui-word-aux">
            </div>
        </div>
        <div id="icon">
            <div class="layui-form-item">
                <label class="layui-form-label">
                    商品源图标
                </label>
                <div class="layui-input-inline4">
                    {php echo tpl_form_field_image('icon',$edit_data['icon'])}
                </div>
                <!--<label class="layui-form-label">-->
                <!--</label>-->
                <div class="layui-form-mid layui-word-aux">
                    <span class="x-red">*</span>设置商品源图标,建议50*50
                </div>
            </div>
        </div>
        <div id="filterpanel">
                <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class="x-red">*</span>拼团价
                        </label>
                        <div class="layui-input-inline4">
                            <div class="layui-input-inline layui-input-inline-w100">
                                <input type="hidden" name="range_id0" value="0"/>
                                <input name="mingroupprice" id="mingroupprice" type="text" value="{$res['groupprice']['value']['mingroupprice']}" placeholder="￥" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-form-mid">-</div>
                            <div class="layui-input-inline layui-input-inline-w100">
                                <input name="maxgroupprice" id="maxgroupprice" type="text" value="{$res['groupprice']['value']['maxgroupprice']}" placeholder="￥" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <!--<label class="layui-form-label">-->
                        <!--</label>-->
                        <div class="layui-form-mid layui-word-aux">
                        </div>
                    </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>券后价
                </label>
                <div class="layui-input-inline4">
                    <div class="layui-input-inline layui-input-inline-w100">
                            <input type="hidden" name="range_id1" value="1"/>
                        <input name="minprice" id="minprice" type="text" value="{$res['price']['value']['minprice']}" placeholder="￥" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline layui-input-inline-w100">
                        <input name="maxprice" id="maxprice" type="text" value="{$res['price']['value']['maxprice']}" placeholder="￥" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--<label class="layui-form-label">-->
                <!--</label>-->
                <div class="layui-form-mid layui-word-aux">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>佣金比例
                </label>
                <div class="layui-input-inline4">
                    <div class="layui-input-inline layui-input-inline-w100">
                            <input type="hidden" name="range_id2" value="2"/>
                        <input name="mincommission" id="mincommission" type="text"  value="{$res['commission']['value']['mincommission']}"  placeholder="%" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline layui-input-inline-w100">
                        <input name="maxcommission" id="maxcommission" type="text"  value="{$res['commission']['value']['maxcommission']}"  placeholder="%" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--<label class="layui-form-label">-->
                <!--</label>-->
                <div class="layui-form-mid layui-word-aux">
                </div>
            </div>
            <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span class="x-red">*</span>优惠券金额
                    </label>
                    <div class="layui-input-inline4">
                        <div class="layui-input-inline layui-input-inline-w100">
                                <input type="hidden" name="range_id3" value="3"/>
                            <input name="mincoupon" id="mincoupon" type="text"  value="{$res['coupon']['value']['mincoupon']}"  placeholder="0" autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline layui-input-inline-w100">
                            <input name="maxcoupon" id="maxcoupon" type="text"  value="{$res['coupon']['value']['maxcoupon']}"  placeholder="99" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <!--<label class="layui-form-label">-->
                    <!--</label>-->
                    <div class="layui-form-mid layui-word-aux">
                    </div>
                </div>
                <div class="layui-form-item">
                        <label class="layui-form-label">
                            <span class="x-red">*</span>销量
                        </label>
                        <div class="layui-input-inline4">
                            <div class="layui-input-inline layui-input-inline-w100">
                                <input type="hidden" name="range_id5" value="5"/>
                                <input name="minsealnum" id="minsealnum" type="text"  value="{$res['seal']['value']['minsealnum']}"  placeholder="0" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-form-mid">-</div>
                            <div class="layui-input-inline layui-input-inline-w100">
                                <input name="maxsealnum" id="maxsealnum" type="text"  value="{$res['seal']['value']['maxsealnum']}"  placeholder="999" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <!--<label class="layui-form-label">-->
                        <!--</label>-->
                        <div class="layui-form-mid layui-word-aux">
                        </div>
                    </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>佣金金额
                </label>
                <div class="layui-input-inline4">
                    <div class="layui-input-inline layui-input-inline-w100">
                            <input type="hidden" name="range_id6" value="6"/>
                        <input name="mincommissionpirce" id="mincommissionpirce" type="text" value="{$res['commissionpirce']['value']['mincommissionpirce']}"  placeholder="￥" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline layui-input-inline-w100">
                        <input name="maxcommissionpirce" id="maxcommissionpirce" type="text" value="{$res['commissionpirce']['value']['maxcommissionpirce']}" placeholder="￥" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--<label class="layui-form-label">-->
                <!--</label>-->
                <div class="layui-form-mid layui-word-aux">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    排序
                </label>
                <div class="layui-input-inline4">
                    <select   name="sort" id="sort">
                        <option value ="0" {if $res['sort']['value']=='0'}selected="selected"{/if}>综合排序</option>
                        <option value ="1" {if $res['sort']['value']=='1'}selected="selected"{/if}>佣金比率升序</option>
                        <option value ="2" {if $res['sort']['value']=='2'}selected="selected"{/if}>佣金比率降序</option>
                        <option value ="3" {if $res['sort']['value']=='3'}selected="selected"{/if}>价格升序</option>
                        <option value ="4" {if $res['sort']['value']=='4'}selected="selected"{/if}>价格降序</option>
                        <option value ="5" {if $res['sort']['value']=='5'}selected="selected"{/if}>销量升序</option>
                        <option value ="6" {if $res['sort']['value']=='6'}selected="selected"{/if}>销量降序</option>
                        <option value ="7" {if $res['sort']['value']=='7'}selected="selected"{/if}>优惠券金额升序</option>
                        <option value ="8" {if $res['sort']['value']=='8'}selected="selected"{/if}>优惠券金额降序</option>
                        <option value ="9" {if $res['sort']['value']=='9'}selected="selected"{/if}>券后价升序</option>
                        <option value ="10" {if $res['sort']['value']=='10'}selected="selected"{/if}>券后价降序</option>
                        <option value ="11" {if $res['sort']['value']=='11'}selected="selected"{/if}>加入时间升序</option>
                        <option value ="12" {if $res['sort']['value']=='12'}selected="selected"{/if}>加入时间降序</option>
                    </select>
                </div>
                <div class="layui-form-mid layui-word-aux">
                </div>
            </div>
            <div class="layui-form-item">
                    <label class="layui-form-label">
                        分类
                    </label>
                    <div class="layui-input-inline4">
                        <select   name="cateid" id="cateid">
                            <option value ="0" {if $res['cate']['value']=='0'}selected="selected"{/if}>无</option>
                            {loop $record $r}
                            <option value ="{$r['cid']}" {if $res['cate']['value']==$r["cid"]}selected="selected"{/if}>{$r['cname']}</option>
                            {/loop}
                        </select>
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                    </div>
                </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>关键词
                </label>
                <div class="layui-input-inline">
                    <input type="text" name="keyword" lay-verify="keyword"
                           autocomplete="off" class="layui-input" value="{$res['keywords']['value']}">
                </div>
                <!--<label class="layui-form-label">-->
                <!--</label>-->
                <div class="layui-form-mid layui-word-aux">
                    关键词,多个关键词以英文逗号,拆分
                </div>
            </div></div>
        <div class="layui-form-item">
            <label class="layui-form-label">
            </label>
            <div class="layui-input-block">
                <input type="hidden" name="token" value="{$_W['token']}" />
                <button  type="submit" class="layui-btn" lay-filter="add" lay-submit="">
                    提交
                </button>
            </div>
        </div>
    </form>
</div>
</body>
</html>
<script>
    {if $edit_data['type']!=3}
    $('#filterpanel').show();$('#icon').hide();
    {else}
    $('#filterpanel').hide();$('#icon').show();
    {/if}


        layui.use(['form','layer'], function(){
            $ = layui.jquery;
            var form = layui.form
                ,layer = layui.layer;

            //自定义验证规则
            form.verify({
                name: function(value){
                    if(value.length <=0){
                        return '请输入商品源名称！';
                    }
                }
            });
            //监听提交
            form.on('submit(add)', function(data){
                var loadii = layer.load();
                console.log(data);
                //发异步，把数据提交给php
                var ajaxurl="<?php echo webUrl('goodssource/pddgoodsource/goodssource_addpost')?>";
                $.post(ajaxurl,data.field,function(res){
                    var res=JSON.parse(res);
                    layer.close(loadii);
                    if(res.status==1){
                        layer.alert(res.result.message, {icon: 6,closeBtn: 0},function () {
                            // 获得frame索引
                            
                            var index = parent.layer.getFrameIndex(window.name);
                            //关闭当前frame
                            parent.layer.close(index);
                            //parent.location.href=parent.location.href;
                        });
                    } else {
                        layer.msg(res.message);
                    }
                });
                return false;
            });
        });

</script>